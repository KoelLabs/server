import sys
import os
from scipy.io import wavfile
import numpy as np

sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from src.feedback import pair_by_words, score_words_wfed, score_words_cer, user_phonetic_errors
from src.phoneme_utils import weighted_needleman_wunsch, map_target_data, validate_target_data
import panphon
import panphon.distance

panphon_dist = panphon.distance.Distance()

user_speech_timestamps = [
    ("j", 0.501336302895323, 0.521380846325167),
    ("u", 0.5414253897550111, 0.5614699331848553),
    ("j", 0.601336302895323, 0.621380846325167),
    ("u", 0.6414253897550111, 0.6614699331848553),
    ("ɡ", 0.8218262806236081, 0.8418708240534521),
    ("ɡ", 0.8218262806236081, 0.8418708240534521),
    ("ɑ", 0.8619153674832962, 0.8819599109131403),
    ("t", 1.042316258351893, 1.0623608017817372),
    ("ə", 1.0824053452115814, 1.1024498886414253),
    ("s", 1.22271714922049, 1.2628062360801782),
    ("t", 1.3028953229398665, 1.3229398663697105),
    ("eɪ", 1.3429844097995547, 1.3630289532293987),
    ("ʌ", 1.5835189309576838, 1.6035634743875278),
    ("w", 1.7639198218262806, 1.7839643652561248),
    ("ɜ˞", 1.7839643652561248, 1.8040089086859687),
    ("d", 2.024498886414254, 2.044543429844098),
    ("ɔ", 2.1648106904231628, 2.1848552338530065),
    ("l", 2.305122494432071, 2.3251670378619154),
    ("ð", 2.385300668151448, 2.405345211581292),
    ("ə", 2.405345211581292, 2.425389755011136),
    # ("t", 2.505567928730512, 2.5256124721603563),
    # ("aɪ", 2.605790645879733, 2.625835189309577),
    # ("m", 2.906458797327394, 2.9265033407572383),
]
actor_speech_timestamps = [
    ("j", 0.24160443037974685, 0.2617381329113924),
    ("u", 0.2617381329113924, 0.281871835443038),
    ("ɡ", 0.34227294303797473, 0.36240664556962027),
    ("ɑ", 0.38254034810126586, 0.40267405063291145),
    ("t", 0.4429414556962025, 0.4630751582278481),
    ("ʌ", 0.4832088607594937, 0.5033425632911394),
    ("s", 0.6845458860759495, 0.7046795886075949),
    ("t", 0.7650806962025317, 0.7852143987341773),
    ("eɪ", 0.8053481012658229, 0.8254818037974684),
    ("æ", 1.0872199367088609, 1.1073536392405066),
    ("n", 1.22815585443038, 1.2482895569620254),
    ("l", 1.369091772151899, 1.3892254746835444),
    ("ɜ˞", 1.4093591772151899, 1.4294928797468356),
    ("t", 1.6106962025316458, 1.630829905063291),
    ("ɔ", 2.0536376582278484, 2.073771360759494),
    ("l", 2.1945735759493674, 2.214707278481013),
    ("ð", 2.27510838607595, 2.295242088607595),
    ("ʌ", 2.295242088607595, 2.3153757911392407),
    ("t", 2.416044303797469, 2.436178006329114),
    ("aɪ", 2.4764454113924055, 2.4965791139240507),
    ("m", 2.7985846518987345, 2.8187183544303798),
]
actor_speech_by_words = [
      ["you", ['j', 'u']],
      ["gotta", ['ɡ', 'ɑ', 't', "ʌ"]],
      ["stay", ['s', 't', 'eɪ']],
      ["alert", ["æ", 'n','l', 'ɜ˞', 't']],
      ["all", ['ɔ', 'l']],
      ["the", ["ð", "ʌ"]],
      ["time", ['t', 'aɪ', 'm']]
    ]


user_speech_transcribed = ["".join(s[0]) for s in user_speech_timestamps]
actor_speech_transcribed = ["".join(s[0]) for s in actor_speech_timestamps]

mapped_user_speech_timestamps, mapped_actor_speech_by_words = map_target_data(user_speech_timestamps, actor_speech_by_words)
print(mapped_user_speech_timestamps)
print(mapped_actor_speech_by_words)
print(validate_target_data(actor_speech_timestamps, actor_speech_by_words))